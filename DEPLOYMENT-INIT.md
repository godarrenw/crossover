# 🚀 部署后初始化指南

部署完成后，您需要按照以下步骤进行系统初始化。

## 📋 初始化步骤

### 1. 访问管理面板
```
https://your-project.pages.dev/admin.html
```

### 2. 登录管理员账户
使用您在环境变量中设置的 `ADMIN_PASSWORD` 登录

### 3. 执行数据库迁移（重要！）
点击 **"🔄 数据库迁移"** 按钮，这将：
- 检查并添加 `investment_income` 字段
- 更新现有数据包含真实投资收益
- 确保数据库结构完整

### 4. 初始化数据库（可选）
如果是全新部署，点击 **"🗄️ 初始化数据库"** 按钮：
- 创建数据表结构
- 插入示例财务数据

### 5. 验证功能
- 访问主页：`https://your-project.pages.dev/`
- 检查图表是否正常显示
- 确认月度数据表格显示正确
- 验证统计数据计算准确

## 🔧 故障排除

### 如果遇到 HTTP 500 错误：
1. 首先尝试"数据库迁移"
2. 如果仍有问题，尝试"初始化数据库"
3. 检查 Cloudflare D1 数据库是否正常运行

### 如果数据不显示：
1. 确认已完成数据库迁移
2. 检查管理面板中是否有数据记录
3. 验证 API 接口是否正常响应

## 🔐 安全特性

### 隐私保护
- **真实总资产** 只有管理员可以查看和编辑
- 普通用户访问 API 时，`total_capital` 字段会被设置为 0
- 无风险收入计算基于真实资产，但不会暴露具体数值

### 权限控制
- 所有数据修改操作需要管理员权限
- API 访问受到管理员令牌保护
- 敏感数据在前端不会显示

## 📊 新功能说明

### 真实总资产管理
- 在管理面板中添加了"真实总资产"字段
- 用于计算无风险收入，但不在首页显示
- 只有管理员可以查看和修改

### 月度数据表格
- 首页新增月度财务数据表格
- 显示：收入、支出、投资收入、预期无风险收入、储蓄率
- 投资收入和储蓄率使用颜色区分正负值

### 界面优化
- 采用现代化的卡片设计
- 去除了图表动画效果，加载更快
- 简化了理论说明，更加简洁

## ⚠️ 重要提醒

1. **必须执行数据库迁移** - 这是升级到新版本的必要步骤
2. **保护管理员密码** - 确保 `ADMIN_PASSWORD` 足够复杂
3. **定期备份数据** - 建议定期导出财务数据进行备份

## 🎯 完成标志

初始化成功后，您应该能够看到：
- ✅ 主页图表正常显示四条线
- ✅ 月度数据表格显示完整信息
- ✅ 统计卡片显示准确数据
- ✅ 管理面板可以正常编辑数据
- ✅ 真实总资产字段可以编辑但不在首页显示

如有任何问题，请检查浏览器控制台的错误信息或联系技术支持。
